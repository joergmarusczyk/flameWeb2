
<!--<div class ="overlay text-center">
  <div class="spinner-border text-primary"  style="width: 10rem; height: 10rem;"  role="status">
    <span class="sr-only">Loading...</span>
  </div>
</div>-->


<div class="container"  *ngIf="this.predictionResult != undefined">
  <div class="row" *ngIf="this.predictionResult != undefined  && this.predictionResult['external-validation']">
    <div class="card w-100" style="width: 18rem;">
      <div class="card-body"> 
        <div class="row ml-2">
            <small class="h2 text-muted"><u>Fitting</u></small>
        </div>
        <div class="row align-items-center">
          <div class="col-2 mt-1">
            <table class="table table-sm mt-4">
              <tbody>
                <tr *ngFor = "let key of objectKeys(modelValidationInfo)">
                  
                  <td  *ngIf="!this.q_measures.includes(key)" class="text-left text-capitalize" data-toggle="tooltip" data-placement="left" title="{{modelValidationInfo[key][0]}}"><strong>{{key.split('_').join(' ')}}:</strong></td>
                  <td  *ngIf="!this.q_measures.includes(key)" class="text-right text-capitalize">{{modelValidationInfo[key][1]}}</td>
              </tr>
              </tbody>
            </table> 
          </div>
          <div class="col-5" *ngIf="this.modelValidationInfo['TP']">
            <!--CONFUSION MATRIX-->
            <app-confusion-matrix 
                  [TP] = "this.modelValidationInfo['TP'][1]"
                  [FP] = "this.modelValidationInfo['FP'][1]"
                  [FN] = "this.modelValidationInfo['FN'][1]"
                  [TN] = "this.modelValidationInfo['TN'][1]"
              ></app-confusion-matrix>                 
          </div>
          <div class="col-5"  *ngIf="this.modelValidationInfo['TP']">
            <div style="display: block">
              <canvas baseChart
                  [data]="polarAreaChartData"
                  [options]="polarChartOptions"
                  [labels]="polarAreaChartLabels"
                  [legend]="polarAreaLegend"
                  [colors]="polarAreaChartColors"
                  [chartType]="polarAreaChartType">
              </canvas>
            </div>
          </div>
        </div><!--row---->
      </div><!--body-->
    </div><!--card-->
  </div>
  <div class="row" *ngIf="this.predictionResult != undefined && this.predictionResult.warning">
    <div class="card w-100">
      <div class="card-body"> 
        <div class="alert alert-danger text-center" role="alert">
          {{this.predictionResult.warning}}
        </div>
      </div>
    </div>
  </div>
 
    <!--<div class="d-flex flex-row-reverse" *ngIf="this.predictionResult != undefined">
      
        <div class="btn-group" role="group" aria-label="Basic example">
          <button type="button" class="btn btn-raised btn-etransafe" (click)="savePDF()"><i class="far fa-file-pdf"></i>  PDF</button>
          <button type="button" class="btn btn-raised btn-etransafe" (click)="saveEXCEL()"><i class="fas fa-file-excel"></i>  Excel</button>
        </div>
      
    </div>-->
  <div class="row mt-3" *ngIf="this.predictionResult != undefined">
    <div class="card w-100">
        <div id="overlay" *ngIf="!this.predictionVisible">
          <div class="spinner-border text-primary"  style="width: 10rem; height: 10rem;"  role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      <!--NAVS tables-->
        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="pills-all-tab" data-toggle="tab" href="#pills-all" role="tab" aria-controls="pills-home" aria-selected="true"><h4>List</h4></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="pills-one-tab" data-toggle="tab" href="#pills-one" role="tab" aria-controls="pills-one" aria-selected="false"><h4>Reports</h4></a>
          </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
          <!--ALL-->
          <div class="tab-pane fade show active" id="pills-all" role="tabpanel" aria-labelledby="pills-all-tab">
            <div class="card-body">
              
              <table  id="prediction" class="table m-0 table-light">
                <thead>
                  <tr>
                    <th >Name</th>
                    <th class="align-middle text-center">Mol</th>
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.ymatrix">Value</th>-->
                    <th class="align-middle text-center" *ngIf="this.predictionResult.values">Prediction</th>
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.upper_limit">Upper limit</th>-->
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.lower_limit">Lower limit</th>-->
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.c0">Inactive</th>-->
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.c1">Active</th>-->
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.ensemble_c0">Ensemble Class 0</th>-->
                    <!--<th class="align-middle text-center" *ngIf="this.predictionResult.ensemble_c1">Ensemble Class 1</th>-->
      
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let res of this.predictionResult.SMILES; let i=index">
                    <td class="align-middle" >{{this.predictionResult.obj_nam[i]}}</td>
                    <td class="align-middle text-center">
                      <canvas #cmp id="{{i}}">{{this.predictionResult.SMILES[i]}}</canvas>
                    </td>
                   <!--<td class="align-middle text-center" *ngIf="this.predictionResult.ymatrix" >{{this.predictionResult.ymatrix[i].toFixed(3)}}</td>-->
                    <td class="align-middle text-center" *ngIf="this.predictionResult.values">{{castValue(this.predictionResult.values[i])}}</td>
                    <!--<td class="align-middle text-center" *ngIf="this.predictionResult.upper_limit">{{this.predictionResult.upper_limit[i].toFixed(3)}}</td>-->
                    <!--<td class="align-middle text-center" *ngIf="this.predictionResult.lower_limit">{{this.predictionResult.lower_limit[i].toFixed(3)}}</td>-->
                    <!--<td class="align-middle text-center" *ngIf="this.predictionResult.c0">{{this.predictionResult.c0[i]}}</td>-->
                    <!--<td class="align-middle text-center" *ngIf="this.predictionResult.c1">{{this.predictionResult.c1[i]}}</td>-->
                    <!--<td class="align-middle text-center" *ngIf="this.predictionResult.ensemble_c0">{{this.predictionResult.ensemble_c0[i].toFixed(3)}}</td>-->
                    <!--<td class="align-middle text-center" *ngIf="this.predictionResult.ensemble_c1">{{this.predictionResult.ensemble_c1[i].toFixed(3)}}</td>-->
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!--END ALL-->
          <!--ONE-->
          <div class="tab-pane fade" id="pills-one" role="tabpanel" aria-labelledby="pills-one-tab" *ngIf="this.predictionResult != undefined">
            <div class="card-body">
              <!--PAGINATION-->
              <div class="row  align-items-center">
                <div class="col-2 offset-5">
                  <span><strong>{{this.i +1}} of {{this.predictionResult.SMILES.length}}</strong></span>
                </div>
                <div class="col-1  p-0 offset-4">
                  <nav aria-label="Page navigation example">
                    <ul class="pagination">
                      <li class="page-item" [ngClass]="{'disabled': this.noPrevious}">
                        <a class="page-link" href="javascript:void(0)" aria-label="Previous" (click) = "Previous()">
                          <span aria-hidden="true">&laquo;</span>
                          <span class="sr-only">Previous</span>
                        </a>
                      </li>
                      <li class="page-item" [ngClass]="{'disabled': this.noNext}">
                        <a class="page-link" href="javascript:void(0)" aria-label="Next" (click) = "Next()">
                          <span aria-hidden="true">&raquo;</span>
                          <span class="sr-only">Next</span>
                        </a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
              <!--END PAGINATION-->


              <div class="row" style="background-color: #22577a;color: white">
                <div class="col-3 border">
                  {{this.prediction.name}}
                </div>
                <div class="col-6 border">
                 Model {{this.prediction.modelName}} version {{this.prediction.modelVersion}}
                </div>
                <div class="col-3 border">
                  {{this.prediction.date}}
                </div>
              </div>
              <div class="row">
                <div class="col-3 border">
                  <strong>Name</strong>
                </div>
                <div class="col-9 border">
                 {{this.predictionResult.obj_nam[i]}}
                </div>
              </div>
              <div class="row">
                <div class="col-3 border">
                  <strong>ID</strong>
                </div>
                <div class="col-9 border">
                  {{this.predictionResult.obj_id[i]}}
                </div>
              </div>
              <div class="row">
                <div class="col-3 border">
                  <strong>Structure</strong>
                </div>
                <div class="col-9 border">
                  <canvas id="one_canvas"></canvas>
                </div>
              </div>
              <div class="row">
                <div class="col-3 border">
                  <strong>Other</strong>
                </div>
                <div class="col-9 border">
                  <span><strong>Activity: </strong></span>
                  <span *ngIf="this.predictionResult.ymatrix">{{this.predictionResult.ymatrix[i]}}</span> 
                  <span *ngIf="!this.predictionResult.ymatrix">-</span> 
                </div>
              </div>
              <div class="row bg-light">
                <div class="col-3 border">
                  <strong>Result</strong>
                </div>
                <div class="col-9 border">
                  <span *ngIf="this.predictionResult.values">{{castValue(this.predictionResult.values[i])}}</span>
                </div>
              </div>
              <div class="row bg-light">
                <div class="col-3 border">
                  <strong>Reliability</strong>
                </div>
                <div class="col-9 border">
                  <span *ngIf="!this.modelBuildInfo['conformal']">-</span>
                  <span *ngIf="this.modelBuildInfo['conformal']">{{(1.0-this.prediction.modelParameters.conformalSignificance.value)*100}}%CI</span>
                  <span *ngIf="this.modelBuildInfo['conformal'] && this.modelBuildInfo['quantitative']">
                    : {{this.predictionResult.lower_limit[i].toFixed(1)}} <strong>-</strong> {{this.predictionResult.upper_limit[i].toFixed(3)}}
                  </span>
                  <!--90%CI: 8.3 - 10.6-->
                </div>
              </div>
              <div class="row bg-light">
                <div class="col-3 border">
                  <strong>Interpretation</strong>
                </div>
                <div class="col-9 border" *ngIf="this.modelDocumentation === undefined">
                  <span>No documentation</span>
                </div>
                <div class="col-9 border" *ngIf="this.modelDocumentation != undefined">
                  <p *ngIf="this.modelDocumentation['Endpoint'].value != undefined">{{this.modelDocumentation['Endpoint'].value}}</p>
                  <p *ngIf="this.modelDocumentation['Comment_on_the_endpoint'].value != undefined"> <br>{{this.modelDocumentation['Comment_on_the_endpoint'].value}}</p>
                  <p *ngIf="this.modelDocumentation['Species'].value != undefined"> <br>{{this.modelDocumentation['Species'].value}}</p>
                </div>
              </div>
              <div class="row bg-light">
                <div class="col-3 border">
                  <strong>Model</strong>
                </div>
                <div class="col-9 border">
                  <span class="text-capitalize">{{this.modelBuildInfo['model']}}</span><span> using {{this.modelBuildInfo['nvarx']}}vars</span>
                  <br><br>
                  <span>Training series {{this.modelBuildInfo['nobj']}} compounds</span><br>
                  <div *ngIf="this.modelBuildInfo['quantitative'] && !this.modelBuildInfo['conformal']">
                    <span>R2: {{this.modelBuildInfo['R2'].toFixed(2)}}, </span>
                    <span>SDEC: {{this.modelBuildInfo['SDEC'].toFixed(2)}}, </span>
                    <span>Q2: {{this.modelBuildInfo['Q2'].toFixed(2)}}, </span>
                    <span>SDEP: {{this.modelBuildInfo['SDEP'].toFixed(2)}}</span>
                  </div>
                  <div *ngIf="!this.modelBuildInfo['quantitative'] && !this.modelBuildInfo['conformal']">
                    <span>Sensitivity: {{this.modelBuildInfo['Sensitivity'].toFixed(2)}}, </span>
                    <span>Specificity: {{this.modelBuildInfo['Specificity'].toFixed(2)}}, </span>
                    <span>MCC: {{this.modelBuildInfo['MCC'].toFixed(2)}}</span><br>
                     <span>Sensitivity (predicted): {{this.modelBuildInfo['SensitivityPed'].toFixed(2)}}, </span>
                    <span>Specificity (predicted): {{this.modelBuildInfo['SpecificityPred'].toFixed(2)}}, </span>
                    <span>MCC (predicted): {{this.modelBuildInfo['MCC'].toFixed(2)}}</span>
                  </div>
                  <div *ngIf="this.modelBuildInfo['quantitative'] && this.modelBuildInfo['conformal']">
                    <span>Conformal mean interval: {{this.modelBuildInfo['Conformal_mean_interval'].toFixed(2)}}, </span>
                    <span>Conformal accuracy: {{this.modelBuildInfo['Conformal_accuracy'].toFixed(2)}} </span>
                  </div>
                  <div *ngIf="!this.modelBuildInfo['quantitative'] && this.modelBuildInfo['conformal']">
                    <span>Sensitivity: {{this.modelBuildInfo['Sensitivity'].toFixed(2)}}, </span>
                    <span>Specificity: {{this.modelBuildInfo['Specificity'].toFixed(2)}}, </span>
                    <span>MCC: {{this.modelBuildInfo['MCC'].toFixed(2)}}, </span>
                    <span>Conformal coverage: {{this.modelBuildInfo['Conformal_coverage'].toFixed(2)}}, </span>
                    <span>Conformal accuracy: {{this.modelBuildInfo['Conformal_accuracy'].toFixed(2)}} </span>
                  </div>
                  <br>
                    <a>QMRF report</a>
                    
                </div>
              </div>
            </div>
          </div>
        </div>
      <!---->
    </div>
  </div>
</div>
